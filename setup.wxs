<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <?define ProductName="Master Refreshing App" ?>
    <?define ProductVersion="1.3.4" ?>
    <?define Manufacturer="ENG. Saeed Al-moghrabi" ?>
    <?define UpgradeCode="20104059-413d-5af8-93e2-323ff91ac225" ?>
    <?define ExeSource="dist\MasterRefreshingApp.exe" ?>
    <?define IconSource="resources\icon.ico" ?>

    <Product Id="*" Name="$(var.ProductName)" Language="1033" Version="$(var.ProductVersion)" Manufacturer="$(var.Manufacturer)" UpgradeCode="$(var.UpgradeCode)">
        <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />

        <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
        <MediaTemplate EmbedCab="yes" />

        <!-- Icon for Add/Remove Programs -->
        <Icon Id="AppIcon" SourceFile="$(var.IconSource)"/>
        <Property Id="ARPPRODUCTICON" Value="AppIcon" />

        <Feature Id="ProductFeature" Title="Master Refreshing App" Level="1">
            <ComponentGroupRef Id="ProductComponents" />
            <ComponentRef Id="ApplicationShortcut" />
            <ComponentRef Id="DesktopShortcut" />
        </Feature>
    </Product>

    <Fragment>
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFilesFolder">
                <Directory Id="INSTALLFOLDER" Name="$(var.ProductName)" />
            </Directory>
            <Directory Id="ProgramMenuFolder" />
            <Directory Id="DesktopFolder" />
        </Directory>
    </Fragment>

    <Fragment>
        <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
            <Component Id="MainExecutable" Guid="beeedc31-4f84-5873-b99f-f03cc8ae0000">
                <File Id="MasterRefreshingAppEXE" Source="$(var.ExeSource)" KeyPath="yes" Checksum="yes"/>
            </Component>
            
            <Component Id="AutoStartRegistry" Guid="beeedc31-4f84-5873-b99f-f03cc8ae0003">
                <RegistryValue Root="HKCU" Key="Software\Microsoft\Windows\CurrentVersion\Run"
                               Name="MasterRefreshingApp" Type="string" Value="[INSTALLFOLDER]MasterRefreshingApp.exe" KeyPath="yes"/>
            </Component>
        </ComponentGroup>
    </Fragment>

    <Fragment>
        <Component Id="ApplicationShortcut" Directory="ProgramMenuFolder" Guid="beeedc31-4f84-5873-b99f-f03cc8ae0001">
            <Shortcut Id="ApplicationStartMenuShortcut"
                      Name="$(var.ProductName)"
                      Description="Professional Excel Auto-Refresher"
                      Target="[INSTALLFOLDER]MasterRefreshingApp.exe"
                      WorkingDirectory="INSTALLFOLDER"
                      Icon="AppIcon"/>
            <RegistryValue Root="HKCU" Key="Software\$(var.Manufacturer)\$(var.ProductName)" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
        </Component>

        <Component Id="DesktopShortcut" Directory="DesktopFolder" Guid="beeedc31-4f84-5873-b99f-f03cc8ae0002">
            <Shortcut Id="ApplicationDesktopShortcut"
                      Name="$(var.ProductName)"
                      Description="Professional Excel Auto-Refresher"
                      Target="[INSTALLFOLDER]MasterRefreshingApp.exe"
                      WorkingDirectory="INSTALLFOLDER"
                      Icon="AppIcon"/>
            <RegistryValue Root="HKCU" Key="Software\$(var.Manufacturer)\$(var.ProductName)" Name="desktop_shortcut" Type="integer" Value="1" KeyPath="yes"/>
        </Component>
    </Fragment>
</Wix>
